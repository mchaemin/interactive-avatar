!function(){let t="tone";const e={tone:"tone_300",hair_type:"hair_short3",hair_color:"black",clothes:"hoodie",accessories:"acc_none"},a=document.querySelector("#avatar-menu"),o=document.querySelectorAll(".avatar-selector"),c=a.querySelectorAll(".avatar-menu-item"),r=document.querySelectorAll(".avatar-image"),n=(document.querySelector("#avatar"),document.querySelector("#save-button"));a.addEventListener("click",function(e){const a=e.target.closest(".avatar-menu-item");if(!a)return;const r=a.dataset.avatarKey;r&&(t=r,function(t){for(const e of o)e.classList.toggle("active",e.dataset.avatarKey==t);for(const e of c)e.classList.toggle("active",e.dataset.avatarKey===t)}(t))});for(const t of o)t.addEventListener("click",s);function s(a){const o=a.target.closest(".avatar-selector-item");if(!o)return;const c=o.closest(".avatar-selector");if(!c||!c.classList.contains("active"))return;const n=o.dataset.avatarValue;n&&function(t,a){e[t]=a;let o=t,c=e[t];0===t.indexOf("hair")&&(o="hair",c=`${e.hair_type}-${e.hair_color}`);for(const t of r)if(t.dataset.imageKey===o){t.setAttribute("src",`../img/avatar/${c}.svg`);break}}(t,n)}n.addEventListener("click",function(){const t=document.querySelector(".avatar");if(!t)return;const e=t=>{const e=document.createElement("a");e.href=t,e.download="avatar.png",e.click()};"undefined"!=typeof domtoimage?domtoimage.toPng(t,{bgcolor:"#ffffff",cacheBust:!0}).then(e).catch(a=>{console.error("domtoimage failed, fallback to html2canvas",a),"undefined"!=typeof html2canvas&&html2canvas(t,{useCORS:!0,backgroundColor:"#ffffff"}).then(t=>e(t.toDataURL("image/png")))}):"undefined"!=typeof html2canvas?html2canvas(t,{useCORS:!0,backgroundColor:"#ffffff"}).then(t=>e(t.toDataURL("image/png"))):console.error("No capture library available")})}();